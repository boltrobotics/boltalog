---
layout: post
title: "Log and metric reporting. Part 4"
---
When the program emits an example event as described previously, the syslog records the following: 

```
2017-08-28T11:45:40.523085-04:00 vmu logger_test[19706]: 1,32,8
```

There is a small problem here - readability. When inspecting program events, I want the information to include event and parameter names to describe the values. This is easy to fix.

Using the same approach as for generating header and source files, I should be able to generate a user-friendly log viewer script. Here is a [template](https://github.com/svkapustin/strong-log/blob/master/model/log_viewer.py.mdl) for it:

```python
  1 .output "log_viewer.py"
  2 .template 1
  3 .ignorecase = 0
  4 \
  5 import sys
  6 
  7 .for log.event
  8 def $(event.name)(header, values):
  9     print(header, " $(event.name)",
 10 .   for event.param
 11 .       if last()
 12         ", $(param.name): ", values[$(index(param))], sep='')
 13 .       else
 14         ", $(param.name): ", values[$(index(param))],
 15 .       endif
 16 .   endfor
 17 
 18 .endfor
 19 \
 20 #$("/" * 79)
 21 
 22 if (len(sys.argv) == 1):
 23     events_in = sys.stdin
 24 else:
 25     events_in = open(sys.argv[1])
 26 
 27 for event in events_in:
 28     tokens = event.split()
 29     values = tokens[3].split(",")
 30 
 31 .for log.event
 32 .   if first()
 33     if \
 34 .   else
 35     elif \
 36 .   endif
 37 values[0] == "$(index(event))":
 38         $(event.name)(" ".join(tokens[0:3]), values)
 39 .endfor
 40
 41 .endtemplate
```

And this is the generated code:

```python
  1 import sys
  2 
  3 def onLogEventA(header, values):
  4     print(header, " onLogEventA",
  5         ", param1: ", values[1],
  6         ", param2: ", values[2], sep='')
  7 
  8 def onLogEventB(header, values):
  9     print(header, " onLogEventB",
 10         ", param1: ", values[1],
 11         ", param2: ", values[2], sep='')
 12         
 13 def onLogEventC(header, values):
 14     print(header, " onLogEventC",
 15         ", p1: ", values[1],
 16         ", p2: ", values[2],
 17         ", p3: ", values[3],
 18         ", p4: ", values[4], sep='')
 19 
 20 #///////////////////////////////////////////////////////////
 21 
 22 if (len(sys.argv) == 1):
 23     events_in = sys.stdin
 24 else:
 25     events_in = open(sys.argv[1])
 26 
 27 for event in events_in:
 28     tokens = event.split()
 29     values = tokens[3].split(",")
 30 
 31     if values[0] == "1":
 32         onLogEventA(" ".join(tokens[0:3]), values)
 33     elif values[0] == "2":
 34         onLogEventB(" ".join(tokens[0:3]), values)
 35     elif values[0] == "3":
 36         onLogEventC(" ".join(tokens[0:3]), values)
 37 
```

When CSV logs are piped through this script, I get:

```
2017-08-29T09:29:45.489459-04:00 vmu logger_test[16643]: onLogEventA, param1: 32, param2: 8
2017-08-29T09:29:45.489729-04:00 vmu logger_test[16643]: onLogEventB, param1: 16, param2: param2
2017-08-29T09:29:45.489919-04:00 vmu logger_test[16643]: onLogEventC, p1: 64, p2: p2, p3: p3, p4: 4
```

The result is significatnly easier to interpret than before. The format can be adjusted to one's preferences by changing only a small block of the template. Even the values of doc attributes for each parameter of the model can be embedded for maximum clarity.

The output from this script will be useful to a developer or sys admin. Tech writers, on the other hand, may benefit from the information formatted for release notes or other documentation, and output to a non-text type of file. Using the same model, a different transformation script could be generated that will produce the desired result.

#### In conclusion
The approach described in these pages may help in solving certain issues related to software maintenance. The biggest of which is  communicating of information between different team members. For me, as a developer, documentation is one of the least exciting parts of the job, but there is no way around it. By spending time more effectively on this and other boring tasks, I'll have more time to do what I like. A simple model-driven development may help me do just that.

#### Links
[Project at github](https://github.com/svkapustin/strong-log)
