.output "logger.hpp"
.template 1
.ignorecase = 0
\

#ifndef _slog_Logger_hpp_
#define _slog_Logger_hpp_

// SYSTEM INCLUDES
#include <cstdint>
#include <array>
#include <memory>
#include <syslog.h>

namespace slog {

$("/" * 80)

.for log.event
.   if defined(event->doc)
/**
 * $(event->doc)
 *
.   else
/**
.   endif
.for event.param
 * @param $(param.name) $(param.doc?)
.endfor
 */
\
#define $(event.name)(\
.for event.param
.   if index(param) > 1
, \
.   endif
$(param.name)\
.endfor
) \\
    if (slog::Logger::instance()->filter($(event.id))) { \\
        slog::Logger::instance()->$(event.name)Impl(\
.       for event.param
.           if index(param) > 1
, \
.           endif
$(param.name)\
.       endfor
); \\
    }

.endfor
\
$("/" * 80)

/**
 * Logging interface for reporting runtime events and metrics.
 *
 * The events are to be logged through the macros defined above.
 */
class Logger {
public:

// LIFECYCLE

    ~Logger() = default;

// OPERATIONS

    /**
     * Factory function to create global logger instance. Call only once at
     * start-up.
     *
     * @param ident - the program name
     * @param facility - the syslog facility
     * @param level - the minimum log level to allow through
     * @return global logger instance
     */
    static Logger* init(
        const std::string& ident = "",
        int facility = LOG_USER,
        int level = LOG_DEBUG);

    /**
     * @return global logger instance
     */
    static Logger* instance();

    /**
     * Set the log level of a given event ID or the base allowed level (event ID 0).
     *
     * @param eventId - the event ID
     * @param level - the level
     * @return the previous level of the event or -1 when given event didn't exist
     */
    int level(int eventId, int level);

    /**
     * @param eventId - the event ID
     * @return true if event is allowed to pass through, false otherwise
     */
    bool filter(int eventId) const;

    //$("-" * 74)

.for log.event
    void $(event.name)Impl(
.    for event.param
.       if last()
        $(param.type) $(param.name)) const;

.       else
        $(param.type) $(param.name),
.       endif
.    endfor
.endfor
    //$("-" * 74)

private:

// OPERATIONS

    /**
     * Ctor.
     *
     * @param ident - the program name
     * @param facility - the syslog facility
     * @param level - the minimum log level to allow through
     */
    Logger(
        const std::string& ident = "",
        int facility = LOG_USER,
        int level = LOG_DEBUG);

// ATTRIBUTES

    static std::unique_ptr<Logger> logger_;
    std::string ident_;
    std::array<int, $(count(log.event) + 1)> levels_;
};

} // namespace slog

#endif // _slog_Logger_hpp_
.endtemplate
